/* ========== Design Tokens ========== */
:root {
    --c-bg: #0a0a1a;
    --c-surface: rgba(255, 255, 255, 0.08);
    --c-surface-raised: rgba(255, 255, 255, 0.12);
    --c-border: rgba(255, 255, 255, 0.15);
    --c-text: #f0f0f0;
    --c-text-dim: rgba(255, 255, 255, 0.5);
    --c-gold: #FFD700;
    --c-gold-dim: #B8860B;
    --c-easy: #4CAF50;
    --c-middle: #FF9800;
    --c-hard: #f44336;
    --c-accent: #6366f1;
    --c-accent-dark: #4338ca;
    --c-purple: #9C27B0;
    --c-info: #4FC3F7;

    --font-display: 'Press Start 2P', monospace;
    --font-body: 'Segoe UI', system-ui, -apple-system, sans-serif;

    --space-xs: clamp(4px, 1vh, 8px);
    --space-sm: clamp(8px, 2vh, 14px);
    --space-md: clamp(12px, 3vh, 20px);
    --space-lg: clamp(16px, 4vh, 28px);
    --space-xl: clamp(24px, 5vh, 40px);

    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;
    --radius-full: 9999px;
}

/* ========== Reset & Base ========== */
*, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    min-height: 100dvh;
    background: var(--c-bg);
    font-family: var(--font-body);
    color: var(--c-text);
    overflow: hidden;
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

.hidden { display: none !important; }

/* Focus styles */
:focus-visible {
    outline: 2px solid var(--c-gold);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ========== Layout ========== */
#game-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    height: 100dvh;
    contain: layout style;
}

#gameCanvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* ========== Game HUD ========== */
.game-hud {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    font-family: var(--font-body);
    contain: layout style;
}

.hud-level {
    position: absolute;
    top: var(--space-sm);
    left: clamp(60px, 15vw, 90px);
    background: var(--c-surface);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    color: #fff;
    font-size: clamp(14px, 3.5vw, 18px);
    font-weight: 700;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid var(--c-border);
}

.hud-cycle {
    position: absolute;
    top: calc(var(--space-sm) - 4px);
    left: clamp(60px, 15vw, 90px);
    color: var(--c-gold);
    font-size: clamp(9px, 2vw, 11px);
    font-weight: 700;
    padding: 2px 8px;
}
.hud-cycle.hell { color: var(--c-hard); }

.hud-diff {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    color: #fff;
    font-size: clamp(10px, 2.5vw, 13px);
    font-weight: 700;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    border: 1px solid var(--c-border);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}
.hud-diff.easy { background: rgba(76, 175, 80, 0.7); }
.hud-diff.middle { background: rgba(255, 152, 0, 0.7); }
.hud-diff.hard { background: rgba(244, 67, 54, 0.7); }

.hud-theme {
    position: absolute;
    top: calc(var(--space-sm) + clamp(30px, 7vw, 40px));
    right: var(--space-sm);
    background: var(--c-surface);
    color: var(--c-text-dim);
    font-size: clamp(9px, 2vw, 11px);
    padding: 3px 10px;
    border-radius: var(--radius-sm);
}

.hud-practice {
    position: absolute;
    top: var(--space-sm);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid var(--c-gold);
    color: var(--c-gold);
    font-size: clamp(10px, 2.5vw, 14px);
    font-weight: 700;
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-md);
    white-space: nowrap;
}
.hud-practice.revive {
    border-color: #E91E63;
    background: rgba(156, 39, 176, 0.6);
    color: #fff;
}

.hud-levelup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #FF69B4;
    font-size: clamp(28px, 8vw, 42px);
    font-weight: 900;
    font-family: var(--font-display);
    text-align: center;
    text-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
    transition: opacity 0.3s;
    pointer-events: none;
}
.hud-levelup .sub {
    display: block;
    font-family: var(--font-body);
    font-size: clamp(12px, 3vw, 18px);
    color: var(--c-gold);
    margin-top: 6px;
    font-weight: 600;
}
.hud-levelup.hell { color: var(--c-hard); }
.hud-levelup.cycle { color: var(--c-gold); }

.hud-token-earn {
    position: absolute;
    top: 35%;
    left: 50%;
    transform: translateX(-50%);
    color: var(--c-gold);
    font-size: clamp(20px, 5vw, 30px);
    font-weight: 900;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    transition: opacity 0.3s;
}

.hud-item {
    position: absolute;
    bottom: var(--space-sm);
    right: var(--space-sm);
    background: rgba(50, 150, 200, 0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    color: #fff;
    font-size: clamp(10px, 2.5vw, 13px);
    font-weight: 700;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-md);
    border: 1px solid var(--c-info);
    min-width: 80px;
    text-align: center;
}
.hud-item.debuff {
    background: rgba(200, 50, 50, 0.6);
    border-color: #EF5350;
}
.hud-item-bar {
    height: 4px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 2px;
    margin-top: 5px;
    overflow: hidden;
}
#hud-item-progress {
    height: 100%;
    background: var(--c-info);
    border-radius: 2px;
    transform-origin: left;
    transition: width 0.1s linear;
}

.hud-credit {
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255, 255, 255, 0.25);
    font-size: 10px;
}

/* ========== UI Overlay ========== */
#ui-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
    z-index: 2;
}

/* ========== Screen Base (Glass style) ========== */
.screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
    pointer-events: auto;
    background: rgba(5, 5, 20, 0.88);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    animation: screenFadeIn 0.25s ease-out;
    contain: layout style;
}

@keyframes screenFadeIn {
    from { opacity: 0; transform: scale(0.97); }
    to { opacity: 1; transform: scale(1); }
}

/* ========== Welcome Screen ========== */
#welcome-screen {
    background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);
    gap: 3vh;
}

#welcome-screen h1 {
    font-family: var(--font-display);
    font-size: clamp(28px, 8vw, 60px);
    color: var(--c-gold);
    text-shadow: 3px 3px 0 var(--c-gold-dim), -1px -1px 0 #FFF8DC;
    animation: title-bounce 1.5s ease-in-out infinite;
    will-change: transform;
}

@keyframes title-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
}

#welcome-screen .subtitle {
    font-family: var(--font-body);
    font-size: clamp(14px, 3.5vw, 22px);
    color: #4A90D9;
    font-weight: 600;
}

.welcome-bird {
    width: clamp(50px, 12vw, 80px);
    height: clamp(50px, 12vw, 80px);
    background: #FFD93D;
    border-radius: 50%;
    position: relative;
    animation: bird-float 2s ease-in-out infinite;
    will-change: transform;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
.welcome-bird::before {
    content: '';
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    border: 7px solid transparent;
    border-left: 10px solid #FF6B35;
}
.welcome-bird::after {
    content: '‚óè';
    position: absolute;
    right: 22%;
    top: 30%;
    font-size: clamp(8px, 2vw, 12px);
    color: #000;
}

@keyframes bird-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

/* ========== Button Base ========== */
.btn {
    font-family: var(--font-body);
    font-weight: 700;
    padding: var(--space-sm) var(--space-md);
    font-size: clamp(10px, 2.5vw, 14px);
    border: 2px solid var(--c-border);
    border-radius: var(--radius-md);
    color: white;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s, background 0.15s;
    box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}
.btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
}

/* Primary CTA */
.fullscreen-btn {
    background: linear-gradient(180deg, #FF6B6B 0%, #EE5A5A 100%);
    border: 3px solid #CC4444;
    border-radius: var(--radius-lg);
    padding: var(--space-md) var(--space-xl);
    color: white;
    font-family: var(--font-display);
    font-size: clamp(12px, 3vw, 18px);
    cursor: pointer;
    box-shadow: 0 4px 0 #AA3333;
    transition: transform 0.1s;
    animation: pulse-btn 2.5s ease-in-out infinite;
    will-change: transform;
    min-height: 48px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}
.fullscreen-btn:active {
    transform: translateY(3px);
    box-shadow: 0 1px 0 #AA3333;
}

@keyframes pulse-btn {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.fullscreen-hint {
    font-size: clamp(9px, 2vw, 12px);
    color: #666;
    margin-top: 8px;
}

/* ========== Start Menu ========== */
#start-screen {
    background: transparent;
    justify-content: space-between;
    padding: 3vh 5vw;
}

.menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    flex-shrink: 0;
}

.menu-header-right {
    display: flex;
    align-items: center;
    gap: clamp(6px, 2vw, 12px);
}

/* Google Login */
.google-login-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: var(--radius-full);
    padding: var(--space-xs) var(--space-sm);
    font-family: var(--font-body);
    font-size: clamp(9px, 2vw, 12px);
    font-weight: 600;
    color: #333;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
    min-height: 36px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: background 0.15s;
}
.google-login-btn:active {
    background: #f0f0f0;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 4px;
    background: var(--c-surface);
    border-radius: var(--radius-full);
    padding: 3px;
    border: 2px solid var(--c-easy);
}

.user-photo {
    width: clamp(26px, 5vw, 32px);
    height: clamp(26px, 5vw, 32px);
    border-radius: 50%;
}

.logout-btn {
    background: rgba(255, 255, 255, 0.15);
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    color: #fff;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    touch-action: manipulation;
}
.logout-btn:active { background: rgba(255, 255, 255, 0.3); }

.menu-title {
    font-family: var(--font-display);
    font-size: clamp(14px, 4vw, 24px);
    color: var(--c-gold);
    text-shadow: 2px 2px 0 #000;
}

.menu-header .token-info {
    background: var(--c-surface);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    font-size: clamp(10px, 2.5vw, 14px);
    color: var(--c-gold);
    border: 1px solid rgba(255, 215, 0, 0.3);
    font-weight: 700;
}

.menu-content {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: clamp(12px, 4vw, 30px);
    flex-shrink: 0;
}

.character-select-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    background: var(--c-surface-raised);
    border: 2px solid rgba(156, 39, 176, 0.5);
    border-radius: var(--radius-md);
    padding: var(--space-sm) var(--space-md);
    cursor: pointer;
    color: white;
    font-family: var(--font-body);
    font-weight: 600;
    font-size: clamp(9px, 2vw, 12px);
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: background 0.15s, transform 0.1s;
    box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
}
.character-select-btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
}

#character-preview {
    width: clamp(30px, 8vw, 50px);
    height: clamp(30px, 8vw, 50px);
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
}

.how-to-play-mini {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: var(--c-surface);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    border: 1px solid rgba(76, 175, 80, 0.3);
    font-size: clamp(10px, 2.5vw, 13px);
    color: #90EE90;
    font-weight: 600;
}

.select-difficulty {
    font-size: clamp(10px, 2.5vw, 14px);
    color: var(--c-text-dim);
    font-weight: 600;
    flex-shrink: 0;
}

.difficulty-buttons {
    display: flex;
    gap: clamp(8px, 2vw, 14px);
    justify-content: center;
    width: 100%;
    flex-shrink: 0;
}

.diff-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-sm) var(--space-md);
    border: 2px solid;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    flex: 1;
    max-width: 150px;
    min-height: clamp(70px, 18vh, 100px);
    box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    background: none;
    color: white;
    font-family: var(--font-body);
}
.diff-btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
}

.diff-btn.easy {
    background: var(--c-easy);
    border-color: #388E3C;
}
.diff-btn.middle {
    background: var(--c-middle);
    border-color: #E65100;
}
.diff-btn.hard {
    background: var(--c-hard);
    border-color: #B71C1C;
}

.diff-icon {
    font-size: clamp(24px, 6vw, 36px);
    margin-bottom: 4px;
}

.diff-name {
    font-size: clamp(11px, 2.8vw, 15px);
    font-weight: 700;
}

.diff-desc {
    font-size: clamp(8px, 1.8vw, 10px);
    opacity: 0.8;
    margin-top: 2px;
}

/* ========== Character Screen ========== */
#character-screen {
    justify-content: center;
    gap: 3vh;
}

#character-screen h2 {
    font-family: var(--font-display);
    font-size: clamp(14px, 4vw, 24px);
    color: var(--c-gold);
}

.character-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(8px, 2vw, 14px);
    max-width: 90%;
    width: 350px;
}

.character-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-sm);
    background: var(--c-surface);
    border: 2px solid var(--c-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.1s, border-color 0.15s;
    min-height: 44px;
    touch-action: manipulation;
}
.character-card:active {
    transform: translateY(2px);
}
.character-card.selected {
    border-color: var(--c-gold);
    background: rgba(255, 215, 0, 0.08);
}
.character-card.locked {
    opacity: 0.4;
}
.character-card canvas {
    width: clamp(40px, 10vw, 56px);
    height: clamp(40px, 10vw, 56px);
}

.character-name {
    font-size: clamp(9px, 2vw, 12px);
    color: #fff;
    margin-top: 5px;
    font-weight: 600;
}

.character-price {
    font-size: clamp(8px, 1.8vw, 10px);
    color: var(--c-gold);
    margin-top: 3px;
}

/* ========== Game Over ========== */
#gameover-screen {
    gap: 2vh;
}

#gameover-screen h2 {
    font-family: var(--font-display);
    font-size: clamp(20px, 6vw, 40px);
    color: var(--c-hard);
    text-shadow: 2px 2px 0 #8B0000;
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
}

.gameover-difficulty {
    font-size: clamp(12px, 3vw, 18px);
    font-weight: 700;
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-full);
    display: inline-block;
}
.gameover-difficulty.easy { background: var(--c-easy); }
.gameover-difficulty.middle { background: var(--c-middle); }
.gameover-difficulty.hard { background: var(--c-hard); }

.score-box {
    background: var(--c-surface);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    padding: var(--space-md) var(--space-lg);
    border: 2px solid var(--c-accent);
    border-radius: var(--radius-md);
}
.score-box p {
    font-size: clamp(11px, 2.8vw, 16px);
    margin: 6px 0;
    font-weight: 600;
}
.score-box span {
    color: var(--c-gold);
}

/* Ranking Feedback */
.ranking-feedback {
    font-size: clamp(9px, 2vw, 12px);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    animation: feedbackPop 0.3s ease-out;
}
.ranking-feedback.saving {
    background: rgba(255, 193, 7, 0.15);
    color: var(--c-gold);
    border: 1px solid rgba(255, 193, 7, 0.3);
}
.ranking-feedback.saved {
    background: rgba(76, 175, 80, 0.15);
    color: #81C784;
    border: 1px solid rgba(76, 175, 80, 0.3);
}
.ranking-feedback.failed {
    background: rgba(244, 67, 54, 0.15);
    color: #EF9A9A;
    border: 1px solid rgba(244, 67, 54, 0.3);
}
.ranking-feedback.guest {
    background: var(--c-surface);
    color: var(--c-text-dim);
    border: 1px solid var(--c-border);
}

@keyframes feedbackPop {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.revive-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}
.token-count {
    font-size: clamp(11px, 2.5vw, 14px);
    color: var(--c-gold);
    font-weight: 700;
}

/* Game over buttons */
.revive-btn, #restart-btn, #home-btn, .pause-menu-btn {
    font-family: var(--font-body);
    font-weight: 700;
    padding: var(--space-sm) var(--space-md);
    font-size: clamp(10px, 2.5vw, 14px);
    border: 2px solid;
    border-radius: var(--radius-md);
    color: white;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}

.revive-btn:active:not(:disabled), #restart-btn:active, #home-btn:active, .pause-menu-btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
}

.revive-btn {
    background: var(--c-purple);
    border-color: #6A1B9A;
}
.revive-btn:disabled {
    background: #444;
    border-color: #333;
    opacity: 0.4;
}

#restart-btn {
    background: var(--c-surface-raised);
    border-color: var(--c-border);
}
#home-btn {
    background: var(--c-accent);
    border-color: var(--c-accent-dark);
}

/* ========== Pause ========== */
#pause-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    width: clamp(40px, 9vw, 50px);
    height: clamp(40px, 9vw, 50px);
    font-size: clamp(16px, 4vw, 22px);
    background: var(--c-surface);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid var(--c-border);
    border-radius: 50%;
    color: white;
    cursor: pointer;
    pointer-events: auto;
    z-index: 20;
    touch-action: manipulation;
}

#pause-screen {
    gap: 3vh;
    z-index: 100;
}
#pause-screen h2 {
    font-family: var(--font-display);
    font-size: clamp(18px, 5vw, 30px);
    color: #fff;
}

.pause-menu-btn {
    width: clamp(180px, 50vw, 260px);
    background: var(--c-accent);
    border-color: var(--c-accent-dark);
}

/* ========== In-Game UI ========== */
#score-display {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-display);
    font-size: clamp(20px, 5vw, 34px);
    color: white;
    text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
    z-index: 10;
    opacity: 0;
}
#score-display.visible { opacity: 1; }

#token-display {
    position: absolute;
    top: 50px;
    right: 15px;
    font-size: clamp(10px, 2.5vw, 14px);
    color: var(--c-gold);
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
    z-index: 10;
    opacity: 0;
    font-weight: 700;
}
#token-display::before { content: 'ü™ô '; }
#token-display.visible { opacity: 1; }

/* ========== Rotate Message ========== */
#rotate-message {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    height: 100dvh;
    background: var(--c-bg);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}

.rotate-content {
    text-align: center;
    color: white;
    padding: 20px;
}
.rotate-icon {
    font-size: clamp(50px, 15vw, 70px);
    animation: rotate-phone 1.5s ease-in-out infinite;
    will-change: transform;
}
.rotate-content p {
    font-size: clamp(12px, 4vw, 16px);
    margin-top: 16px;
    color: var(--c-gold);
    font-weight: 700;
}

@keyframes rotate-phone {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(90deg); }
}

@media (orientation: portrait) {
    #rotate-message { display: flex; }
    #game-container { display: none; }
}
@media (orientation: landscape) {
    #rotate-message { display: none; }
    #game-container { display: block; }
}

/* ========== Ranking Button ========== */
.ranking-btn {
    font-family: var(--font-body);
    font-weight: 700;
    padding: var(--space-sm) var(--space-md);
    font-size: clamp(10px, 2.5vw, 14px);
    border: 2px solid rgba(255, 215, 0, 0.4);
    border-radius: var(--radius-md);
    color: white;
    cursor: pointer;
    transition: transform 0.1s;
    box-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
    background: rgba(255, 179, 0, 0.3);
    min-height: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}
.ranking-btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
}

.start-ranking-btn {
    font-family: var(--font-body);
    font-weight: 700;
    padding: var(--space-xs) var(--space-sm);
    font-size: clamp(9px, 2vw, 12px);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: var(--radius-md);
    color: var(--c-gold);
    cursor: pointer;
    transition: transform 0.1s;
    box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
    background: var(--c-surface);
    flex-shrink: 0;
    min-height: 40px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}
.start-ranking-btn:active {
    transform: translateY(1px);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
}

/* ========== Ranking Screen ========== */
#ranking-screen {
    justify-content: flex-start;
    padding: 2vh 3vw;
    gap: 1.5vh;
    z-index: 200;
}

.ranking-header {
    display: flex;
    align-items: center;
    gap: clamp(10px, 3vw, 20px);
    width: 100%;
    flex-shrink: 0;
}
.ranking-header h2 {
    font-family: var(--font-display);
    font-size: clamp(14px, 4vw, 22px);
    color: var(--c-gold);
}

.ranking-back-btn {
    background: var(--c-surface);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-sm);
    color: #fff;
    font-size: clamp(16px, 4vw, 22px);
    padding: var(--space-xs) var(--space-sm);
    cursor: pointer;
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: manipulation;
}
.ranking-back-btn:active { background: var(--c-surface-raised); }

.ranking-difficulty-tabs,
.ranking-period-tabs {
    display: flex;
    gap: clamp(4px, 1vw, 6px);
    width: 100%;
    flex-shrink: 0;
}

.rank-diff-tab,
.rank-period-tab {
    flex: 1;
    padding: var(--space-xs) 0;
    font-family: var(--font-body);
    font-weight: 700;
    font-size: clamp(9px, 2vw, 12px);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-sm);
    background: var(--c-surface);
    color: var(--c-text-dim);
    cursor: pointer;
    min-height: 36px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    transition: background 0.15s, color 0.15s;
}

.rank-diff-tab.active {
    background: var(--c-easy);
    border-color: #388E3C;
    color: #fff;
}
.rank-diff-tab[data-diff="middle"].active {
    background: var(--c-middle);
    border-color: #E65100;
}
.rank-diff-tab[data-diff="hard"].active {
    background: var(--c-hard);
    border-color: #B71C1C;
}
.rank-period-tab.active {
    background: var(--c-accent);
    border-color: var(--c-accent-dark);
    color: #fff;
}

.ranking-list {
    flex: 1;
    overflow-y: auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 4px;
    touch-action: pan-y;
}

.ranking-loading,
.ranking-empty {
    font-size: clamp(10px, 2.5vw, 14px);
    color: var(--c-text-dim);
    text-align: center;
    padding: 20px;
}

.rank-row {
    display: flex;
    align-items: center;
    gap: clamp(6px, 1.5vw, 10px);
    background: var(--c-surface);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid transparent;
}
.rank-row.rank-me {
    background: rgba(99, 102, 241, 0.2);
    border-color: var(--c-accent);
}

.rank-num {
    font-size: clamp(10px, 2.5vw, 16px);
    min-width: clamp(24px, 6vw, 36px);
    text-align: center;
    font-weight: 700;
}
.rank-photo {
    width: clamp(24px, 5vw, 30px);
    height: clamp(24px, 5vw, 30px);
    border-radius: 50%;
    flex-shrink: 0;
}
.rank-photo-default {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--c-surface-raised);
    color: var(--c-text-dim);
    font-size: clamp(9px, 2vw, 12px);
}
.rank-name {
    flex: 1;
    font-size: clamp(9px, 2vw, 12px);
    color: #ddd;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-weight: 500;
}
.rank-score {
    font-size: clamp(10px, 2.5vw, 14px);
    color: var(--c-gold);
    font-weight: 700;
}
